<!-- entry-detail.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'Entry: ' + ${key} + ' - AshRedis'">Entry Detail</title>
</head>
<body>
<th:block th:replace="base :: layout(~{::title}, ~{::main})">
    <main>
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Entry Detail</h1>
            <div>
                <a th:href="@{/region/{name}(name=${region})}" class="btn btn-secondary">Back to Region</a>
                <button type="button"
                        class="btn btn-danger ms-2"
                        th:if="${user.isAdmin() and isPrimary}"
                        data-bs-toggle="modal" data-bs-target="#deleteModal">
                    <i class="bi bi-trash"></i> Delete Entry
                </button>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üìã Key Information</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Region:</dt>
                    <dd class="col-sm-9">
                        <span class="badge bg-info" th:text="${region}">region0</span>
                        <a th:href="@{/region/{name}(name=${region})}" class="btn btn-sm btn-link">
                            View all keys in region ‚Üí
                        </a>
                    </dd>

                    <dt class="col-sm-3">Key:</dt>
                    <dd class="col-sm-9">
                        <code style="font-size: 1.1em;" th:text="${key}">mykey</code>
                    </dd>

                    <dt class="col-sm-3">TTL (Time To Live):</dt>
                    <dd class="col-sm-9">
                            <span th:if="${ttl == -1}" class="badge bg-success">
                                <i class="bi bi-infinity"></i> No expiration
                            </span>
                        <span th:if="${ttl == -2}" class="badge bg-danger">
                                <i class="bi bi-x-circle"></i> Key does not exist
                            </span>
                        <span th:if="${ttl > 0}" class="badge bg-warning text-dark"
                              th:text="'‚è±Ô∏è ' + ${ttl} + ' seconds remaining'">
                                60 seconds
                            </span>
                    </dd>

                    <dt class="col-sm-3">Value:</dt>
                    <dd class="col-sm-9">
                        <div class="position-relative">
                                <pre class="bg-light p-3 border rounded"
                                     style="max-height: 400px; overflow-y: auto;"
                                     th:text="${value != null ? value : 'null'}">value</pre>
                            <button type="button" class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                                    onclick="copyToClipboard()"
                                    title="Copy to clipboard">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                    </dd>
                </dl>

                <!-- Action Buttons -->
                <div class="mt-4" th:if="${user.isAdmin() and isPrimary}">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal">
                        <i class="bi bi-pencil"></i> Edit Value
                    </button>
                    <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#ttlModal">
                        <i class="bi bi-clock"></i> Change TTL
                    </button>
                </div>
            </div>
        </div>

        <!-- Update Value Modal -->
        <div class="modal fade" id="updateModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <form th:action="@{/entry/update}" method="post">
                        <input type="hidden" name="region" th:value="${region}">
                        <input type="hidden" name="key" th:value="${key}">
                        <div class="modal-header">
                            <h5 class="modal-title">Update Entry Value</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="value" class="form-label">Value</label>
                                <textarea class="form-control" id="value" name="value" rows="10"
                                          th:text="${value}" required style="font-family: monospace;"></textarea>
                                <div class="form-text">
                                    Enter the new value for this key.
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Change TTL Modal -->
        <div class="modal fade" id="ttlModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form th:action="@{/entry/update}" method="post">
                        <input type="hidden" name="region" th:value="${region}">
                        <input type="hidden" name="key" th:value="${key}">
                        <input type="hidden" name="value" th:value="${value}">
                        <div class="modal-header">
                            <h5 class="modal-title">Change TTL (Time To Live)</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="ttl" class="form-label">TTL (seconds)</label>
                                <input type="number" class="form-control" id="ttl" name="ttl"
                                       th:value="${ttl > 0 ? ttl : 0}" min="0">
                                <div class="form-text">
                                    Set to 0 for no expiration. Current TTL:
                                    <strong th:if="${ttl == -1}">No expiration</strong>
                                    <strong th:if="${ttl > 0}" th:text="${ttl + ' seconds'}">60 seconds</strong>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <small>
                                    <strong>Quick Values:</strong><br>
                                    60 = 1 minute | 3600 = 1 hour | 86400 = 1 day | 604800 = 1 week
                                </small>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Update TTL</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form th:action="@{/entry/delete}" method="post">
                        <input type="hidden" name="region" th:value="${region}">
                        <input type="hidden" name="key" th:value="${key}">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title">‚ö†Ô∏è Confirm Delete</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-danger">
                                <strong>Warning:</strong> This action cannot be undone!
                            </div>
                            <p>Are you sure you want to delete this entry?</p>
                            <dl class="row">
                                <dt class="col-sm-3">Region:</dt>
                                <dd class="col-sm-9"><code th:text="${region}">region0</code></dd>
                                <dt class="col-sm-3">Key:</dt>
                                <dd class="col-sm-9"><code th:text="${key}">mykey</code></dd>
                            </dl>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">
                                <i class="bi bi-trash"></i> Delete Permanently
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</th:block>

<script th:inline="javascript">
    function copyToClipboard() {
        const value = [[${value}]];
        navigator.clipboard.writeText(value).then(function() {
            alert('Value copied to clipboard!');
        }, function(err) {
            console.error('Could not copy text: ', err);
        });
    }
</script>
</body>
</html>